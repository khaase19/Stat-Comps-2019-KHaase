---
header-includes:
- \usepackage{amssymb,amsthm,amsmath}
- \usepackage{chemarr}
output: pdf_document
---

<!--
You can delete the header-includes (lines 3-5 above) if you like and also the chunk below since it is loaded in the skeleton.Rmd file.  They are included so that chap2.Rmd will compile by itself when you hit Knit PDF.
-->

# Example {#typeset-equ}

```{r, warning= FALSE}
#loading in packages
library(readr)
library(factoextra)
library(NbClust)
library(ggplot2)
library(cluster)
library(GGally)
```

## Exploring the Data
In this example, I will further explore the data from my Stat 495 final project. The data is from DataUSA, which uses public US Government data to analyze and visualize relationships. In the project, we decided to use data from 2016 because of size restrictions. The data contains spatial information, quantitative, and a few categorical variables. 

There is demographic information as well as variables that are indicators of health status. The health status variables include: poor to fair health (the percentage of adults reporting fair or poor health (age-adjusted)), poor physical health days (average number of physically unhealthy days reported in the past 30 days (age-adjusted)), physical inactivity (the percentage of adults aged 20 and over reporting no leisure-time physical inactivity), and adult obesity (the percentage of adults to report a BMI of greater than or equal to 30). 

For our Stat 495 project, 

Needed a sample of 1000...

Importing the data:

```{r, warning= FALSE}
#using data from final stat 495 project
#library(readr)
data_subset <- read_csv("CopyOfdata_subset.csv")

set.seed(1)
#getting a sample of 1000 observations
mysample <- data_subset[sample(1:nrow(data_subset), 1000,
   replace=FALSE),]
```

Picking variables to focus on--> expanding conclusions from Stat 495 project

```{r, warning= FALSE}
#only keeping the variables I want to look at
myvars <- c("Latitude_tri", "Longitude_tri", "poor_or_fair_health", "poor_physical_health_days", "physical_inactivity", "adult_obesity")
smallsample <- mysample[myvars]
```

## Applying CLARA
Step 1: finding k

```{r}
#finding k with project data, using Elbow Method
#pkgs <- c("factoextra",  "NbClust")
#install.packages(pkgs)

#library(factoextra)
#library(NbClust)
#library(ggplot2)
new<- na.omit(smallsample)
# Elbow method
fviz_nbclust(new, kmeans, method = "wss") +
    geom_vline(xintercept = 4, linetype = 2)+
  labs(subtitle = "Elbow method")
```

Step 2: Run CLARA function

```{r}
#new<- na.omit(smallsample)
#library(cluster)
## run CLARA
clarasamp <- clara(new[1:6], 4)
```

```{r}
## print components of clarax
print(clarasamp)
summary(clarasamp)
```

```{r}
## plot clusters
plot(new, col = clarasamp$cluster)
## plot centers
points(clarasamp$centers, col = 1:2, pch = 8)
```

```{r} 
#plotting clara
factoextra::fviz_cluster(clarasamp)
```

## Evaluation of CLARA



### Model to Predict Cluster

First, had to include a cluster variable in the original data set, using the data provided by the CLARA function. 

```{r}
#adding each data point's cluster #
cluster<- clarasamp$clustering
cluster_data<- cbind(new, cluster)
```

```{r, warning= FALSE}
kitchen_sink<- lm(cluster~., data=cluster_data)
summary(kitchen_sink)

#taking out lat and long
vars <- names(cluster_data) %in% c("Latitude_tri", "Longitude_tri")
cluster_data_new <- cluster_data[!vars]

ggpairs(cluster_data_new)
```

```{r}
fun1<- lm(cluster~ poor_physical_health_days, data= cluster_data_new)
summary(fun1)
```


